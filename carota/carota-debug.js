!function(t){"use strict";var e,n,r,i,o,a={".js":[],".json":[],".css":[],".html":[]},s="function"==typeof require?require:null;return i=function(t){var e=new Error("Could not find module '"+t+"'");return e.code="MODULE_NOT_FOUND",e},o=function(t,e,n){var r,i;if("function"==typeof t[e+n])return e+n;for(r=0;i=a[n][r];++r)if("function"==typeof t[e+i])return e+i;return null},e=function(t,r,a,s,u,c){var l,f,h,d,p,v;for("."!==(l=(a=a.split("/")).pop())&&".."!==l||(a.push(l),l="");null!=(f=a.shift());)if(f&&"."!==f&&(".."===f?(t=r.pop(),c=c.slice(0,c.lastIndexOf("/"))):(r.push(t),t=t[f],c+="/"+f),!t))throw i(s);if(l&&"function"!=typeof t[l]&&((v=o(t,l,".js"))||(v=o(t,l,".json")),v||(v=o(t,l,".css")),v||(v=o(t,l,".html")),v?l=v:2!==u&&"object"==typeof t[l]&&(r.push(t),t=t[l],c+="/"+l,l="")),!l)return 1!==u&&t[":mainpath:"]?e(t,r,t[":mainpath:"],s,1,c):e(t,r,"index",s,2,c);if(!(p=t[l]))throw i(s);return p.hasOwnProperty("module")?p.module.exports:(h={},p.module=d={exports:h,id:c+"/"+l},p.call(h,h,d,n(t,r,c)),d.exports)},r=function(n,r,o,a){var u,c=o,l=o.charAt(0),f=0;if("/"===l){if(c=c.slice(1),!(n=t["/"])){if(s)return s(o);throw i(o)}a="/",r=[]}else if("."!==l){if(u=c.split("/",1)[0],!(n=t[u])){if(s)return s(o);throw i(o)}a=u,r=[],(c=c.slice(u.length+1))||((c=n[":mainpath:"])?f=1:(c="index",f=2))}return e(n,r,c,o,f,a)},(n=function(t,e,n){return function(i){return r(t,[].concat(e),i,n)}})(t,[],"")}({carota:{src:{"carota.js":function(t,e,n){var r={node:n("./node"),editor:n("./editor"),document:n("./doc"),dom:n("./dom"),runs:n("./runs"),html:n("./html"),frame:n("./frame"),text:n("./text"),rect:n("./rect")};if(e.exports=r,"undefined"!=typeof window&&window.document){if(window.carota)throw new Error("Something else is called carota!");window.carota=r}},"characters.js":function(t,e,n){function r(t,e,n){return Object.create(s,{_runs:{value:t},_run:{value:e},_offset:{value:n},char:{value:e>=t.length?null:o.getTextChar(t[e].text,n)}})}function i(t,e){for(;e<t.length;e++)if(0!=o.getTextLength(t[e].text))return r(t,e,0);return r(t,t.length,0)}var o=n("./runs"),a=function(t,e){if(t._runs!==e._runs)throw new Error("Characters for different documents")},s={equals:function(t){return a(this,t),this._run===t._run&&this._offset===t._offset},cut:function(t){a(this,t);var e=this;return function(n){for(var r=e._run;r<=t._run;r++){var i=e._runs[r];if(i){var a=r===e._run?e._offset:0,s=r===t._run?t._offset:o.getTextLength(i.text);a<s&&o.getSubText((function(t){var e=Object.create(i);e.text=t,n(e)}),i.text,a,s-a)}}}}};e.exports=function(t){return function(e){for(var n=i(t,0);!e(n)&&null!==n.char;)n=n._offset+1<o.getTextLength(t[n._run].text)?r(t,n._run,n._offset+1):i(t,n._run+1)}}},"codes.js":function(t,e,n){var r=n("./text"),i=n("./frame"),o=n("./node"),a=n("./rect"),s=n("./util"),u=o.derive({parent:function(){return this._parent},draw:function(t){this.inline.draw(t,this.left,this.baseline,this.measured.width,this.measured.ascent,this.measured.descent,this.formatting)},position:function(t,e,n){this.left=t,this.baseline=e,n&&(this._bounds=n)},bounds:function(){return this._bounds||a(this.left,this.baseline-this.measured.ascent,this.measured.width,this.measured.ascent+this.measured.descent)},byCoordinate:function(t){return t<=this.bounds().center().x?this:this.next()}}),c=function(t,e,n,r,i){if(!t.draw||!t.measure)throw new Error;return Object.create(u,{inline:{value:t},_parent:{value:e},ordinal:{value:n},length:{value:r},formatting:{value:i},measured:{value:t.measure(i)}})},l={number:function(t,e){var n=e+1+".";return{measure:function(t){return r.measure(n,t)},draw:function(t,e,i,o,a,s,u){r.draw(t,n,u,e,i,o,a,s)}}}},f=function(t){return s.derive(t,{eof:!0,measure:function(){return{width:18,ascent:0,descent:0}},draw:function(){}})};l.listNext=l.listEnd=f,l.listStart=function(t,e,n){return s.derive(t,{block:function(e,r,s,u,l,f){var h,d,p,v=o.generic("list",l,e,r),g=50,m=10,y=function(t,a){h=o.generic("item",v);var l=n(t.marker||{$:"number"},v.children().length);(p=c(l,h,u,1,a)).block=!0,d=i(e+g,r,s-g,u+1,h,(function(t){return"listEnd"===t.$}),p.measured.ascent)};return y(t,f),function(t){if(d?d((function(t){u=t.ordinal+t.length;var n=t.bounds(),i=t.first(),o=e+g-m-p.measured.width,s=a(e,r,g,n.h);"baseline"in i?p.position(o,i.baseline,s):p.position(o,r+p.measured.ascent,s),r=n.t+n.h,h.children().push(p),h.children().push(t),h.finalize(),v.children().push(h),h=d=p=null}),t):u++,!d){var n=t.code();if(n){if("listEnd"==n.$)return v.finalize(),v;"listNext"==n.$&&y(n,t.codeFormatting())}}}}})},e.exports=t=function(t,e,n){var r=l[t.$];return r&&r(t,e,n)},t.editFilter=function(t){var e=0;if(!t.words.some((function(n,r){var i=n.code();if(i)switch(i.$){case"listStart":e++;break;case"listNext":if(0===e)return t.spliceWordsWithRuns(r,1,[s.derive(n.codeFormatting(),{text:{$:"listStart",marker:i.marker}})]),!0;break;case"listEnd":0===e&&t.spliceWordsWithRuns(r,1,[]),e--}}))&&e>0){for(var n=[];e>0;)e--,n.push({text:{$:"listEnd"}});t.spliceWordsWithRuns(t.words.length-1,0,n)}}},"doc.js":function(t,e,n){var r=n("per"),i=n("./characters"),o=n("./split"),a=n("./word"),s=n("./node"),u=n("./runs"),c=n("./range"),l=n("./util"),f=n("./frame"),h=n("./codes"),d=n("./rect"),p=function(t,e,n,r){var i=t.selection.start,o=t.selection.end;return function(a){t._wordOrdinals=[];var s=Array.prototype.splice.apply(t.words,[e,n].concat(r));a(p(t,e,r.length,s)),t._nextSelection={start:i,end:o}}},v=function(t){var e=[],n=function(t){e.push(t),n.length=e.length};return t(n),function(t){t(v((function(t){for(;e.length;)e.pop()(t)})))}},g=function(t){if(t.isNewLine())return!0;var e=t.code();return!(!e||!e.block&&!e.eof)},m=s.derive({load:function(t,e){var n=this;this.undo=[],this.redo=[],this._wordOrdinals=[],this.words=r(i(t)).per(o(n.codes)).map((function(t){return a(t,n.codes)})).all(),this.layout(),this.contentChanged.fire(),this.select(0,0,e)},layout:function(){this.frame=null;try{this.frame=r(this.words).per(f(0,0,this._width,0,this)).first()}catch(t){}if(this.frame){if(this._nextSelection){var t=this._nextSelection;delete this._nextSelection,this.select(t.start,t.end)}}else this.performUndo()},range:function(t,e){return c(this,t,e)},documentRange:function(){return this.range(0,this.frame.length-1)},selectedRange:function(){return this.range(this.selection.start,this.selection.end)},save:function(){return this.documentRange().save()},paragraphRange:function(t,e){var n,r=this.wordContainingOrdinal(t);if(t=0,r&&!g(r.word))for(n=r.index;n>0;n--)if(g(this.words[n-1])){t=this.wordOrdinal(n);break}var i=this.wordContainingOrdinal(e);if(e=this.frame.length-1,i&&!g(i.word))for(n=i.index;n<this.words.length;n++)if(g(this.words[n])){e=this.wordOrdinal(n);break}return this.range(t,e)},insert:function(t,e){this.select(this.selection.end+this.selectedRange().setText(t),null,e)},modifyInsertFormatting:function(t,e){this.nextInsertFormatting[t]=e,this.notifySelectionChanged()},applyInsertFormatting:function(t){var e=this.nextInsertFormatting,n=Object.keys(e);n.length&&t.forEach((function(t){n.forEach((function(n){t[n]=e[n]}))}))},wordOrdinal:function(t){if(t<this.words.length){var e=this._wordOrdinals.length;if(e<t+1)for(var n=e>0?this._wordOrdinals[e-1]:0,r=e;r<=t;r++)this._wordOrdinals[r]=n,n+=this.words[r].length;return this._wordOrdinals[t]}},wordContainingOrdinal:function(t){var e,n=0;return this.words.some((function(r,i){if(t>=n&&t<n+r.length)return e={word:r,ordinal:n,index:i,offset:t-n},!0;n+=r.length})),e},runs:function(t,e){var n=this.wordContainingOrdinal(Math.max(0,e.start)),r=this.wordContainingOrdinal(Math.min(e.end,this.frame.length-1));if(n.index===r.index)n.word.runs(t,{start:n.offset,end:r.offset});else{n.word.runs(t,{start:n.offset});for(var i=n.index+1;i<r.index;i++)this.words[i].runs(t);r.word.runs(t,{end:r.offset})}},spliceWordsWithRuns:function(t,e,n){var s=this,u=r(i(n)).per(o(s.codes)).truthy().map((function(t){return a(t,s.codes)})).all(),c=!1;if("_filtersRunning"in s)s._filtersRunning++;else{for(var l=0;l<e;l++)this.words[t+l].code()&&(c=!0);c||(c=u.some((function(t){return!!t.code()})))}this.transaction((function(n){if(p(s,t,e,u)(n),c){s._filtersRunning=0;try{for(;;){var r=s._filtersRunning;if(!s.editFilters.some((function(t){return t(s),r!==s._filtersRunning})))break}}finally{delete s._filtersRunning}}}))},splice:function(t,e,n){if("string"==typeof n){var i=Math.max(0,t-1),o=r({start:i,end:i+1}).per(this.runs,this).first();n=[o?Object.create(o,{text:{value:n}}):{text:n}]}else Array.isArray(n)||(n=[{text:n}]);this.applyInsertFormatting(n);var a,s,c=this.wordContainingOrdinal(t),l=this.wordContainingOrdinal(e);if(t===c.ordinal)if(c.index>0&&!g(this.words[c.index-1])){c.index--;var f=this.words[c.index];a=r({}).per(f.runs,f).all()}else a=[];else a=r({end:c.offset}).per(c.word.runs,c.word).all();e===l.ordinal?e===this.frame.length-1||g(l.word)?(s=[],l.index--):s=r({}).per(l.word.runs,l.word).all():s=r({start:l.offset}).per(l.word.runs,l.word).all();var h=this.frame.length;return this.spliceWordsWithRuns(c.index,l.index-c.index+1,r(a).concat(n).concat(s).per(u.consolidate()).all()),this.frame?this.frame.length-h:0},registerEditFilter:function(t){this.editFilters.push(t)},width:function(t){if(0===arguments.length)return this._width;this._width=t,this.layout()},children:function(){return[this.frame]},toggleCaret:function(){var t=this.caretVisible;return this.selection.start===this.selection.end&&(this.selectionJustChanged?this.selectionJustChanged=!1:this.caretVisible=!this.caretVisible),this.caretVisible!==t},getCaretCoords:function(t){var e,n=this.byOrdinal(t);if(n){if(n.block&&t>0){var r=this.byOrdinal(t-1);if(r.newLine){var i=r.bounds(),o=r.parent().parent().bounds();e=d(o.l,o.b,1,i.h)}else e=r.bounds(),e=d(e.r,e.t,1,e.h)}else e=(e=n.bounds()).h?d(e.l,e.t,1,e.h):d(e.l,e.t,e.w,1);return e}},byCoordinate:function(t,e){for(var n=this.frame.byCoordinate(t,e).ordinal,r=this.getCaretCoords(n);r.b<=e&&n<this.frame.length-1;)n++,r=this.getCaretCoords(n);for(;r.t>=e&&n>0;)n--,r=this.getCaretCoords(n);return this.byOrdinal(n)},drawSelection:function(t,e){if(this.selection.end===this.selection.start){if(this.selectionJustChanged||e&&this.caretVisible){var n=this.getCaretCoords(this.selection.start);n&&(t.save(),t.fillStyle="black",n.fill(t),t.restore())}}else t.save(),t.fillStyle=e?"rgba(0, 100, 200, 0.3)":"rgba(160, 160, 160, 0.3)",this.selectedRange().parts((function(e){e.bounds(!0).fill(t)})),t.restore()},notifySelectionChanged:function(t){var e=null,n=this,r=function(){return e||(e=n.selectedRange().getFormatting()),e};this.selectionChanged.fire(r,t)},select:function(t,e,n){this.frame&&(this.selection.start=Math.max(0,t),this.selection.end=Math.min("number"==typeof e?e:this.selection.start,this.frame.length-1),this.selectionJustChanged=!0,this.caretVisible=!0,this.nextInsertFormatting={},this.notifySelectionChanged(n))},performUndo:function(t){var e=t?this.redo:this.undo,n=t?this.undo:this.redo,r=e.pop();r&&(r((function(t){n.push(t)})),this.layout(),this.contentChanged.fire())},canUndo:function(t){return t?!!this.redo.length:!!this.undo.length},transaction:function(t){if(this._currentTransaction)t(this._currentTransaction);else{for(var e=this;this.undo.length>50;)e.undo.shift();this.redo.length=0;var n=!1;this.undo.push(v((function(r){e._currentTransaction=r;try{t(r)}finally{n=r.length>0,e._currentTransaction=null}}))),n&&(e.layout(),e.contentChanged.fire())}},type:"document"});e.exports=function(){var t=Object.create(m);return t._width=0,t.selection={start:0,end:0},t.caretVisible=!0,t.customCodes=function(){},t.codes=function(e,n){return h(e,n,t.codes)||t.customCodes(e,n,t.codes)},t.selectionChanged=l.event(),t.contentChanged=l.event(),t.editFilters=[h.editFilter],t.load([]),t}},"dom.js":function(t){t.isAttached=function(t){for(var e=t;e.parentNode;)e=e.parentNode;return!!e.body},t.clear=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.setText=function(e,n){t.clear(e),e.appendChild(document.createTextNode(n))},t.handleEvent=function(t,e,n){t.addEventListener(e,(function(t){!1===n(t)&&t.preventDefault()}))},t.handleMouseEvent=function(e,n,r){t.handleEvent(e,n,(function(t){var n=e.getBoundingClientRect();return r(t,t.clientX-n.left,t.clientY-n.top)}))},t.effectiveStyle=function(t,e){return document.defaultView.getComputedStyle(t).getPropertyValue(e)}},"editor.js":function(t,e,n){n("per");var r=n("./doc"),i=n("./dom"),o=n("./rect");setInterval((function(){var t=document.querySelectorAll(".carotaEditorCanvas"),e=document.createEvent("Event");e.initEvent("carotaEditorSharedTimer",!0,!0);for(var n=0;n<t.length;n++)t[n].dispatchEvent(e)}),200),t.create=function(t){function e(){var e=l.frame.bounds().h;if(e<t.clientHeight)switch(O){case"middle":return(t.clientHeight-e)/2;case"bottom":return t.clientHeight-e}return 0}function n(t,n){i.handleMouseEvent(s,t,(function(t,r,i){n(l.byCoordinate(r,i-e()))}))}"absolute"!==i.effectiveStyle(t,"position")&&(t.style.position="relative"),t.innerHTML='<div class="carotaSpacer"><canvas width="100" height="100" class="carotaEditorCanvas" style="position: absolute;"></canvas></div><div class="carotaTextArea" style="overflow: hidden; position: absolute; height: 0;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none; font-size: 4px;"></textarea>';var a=t.querySelector("canvas"),s=t.querySelector(".carotaSpacer"),u=t.querySelector(".carotaTextArea"),c=t.querySelector("textarea"),l=r(),f=0,h=null,d=null,p=null,v=null,g="",m=null,y=null,w={66:"bold",73:"italic",85:"underline",83:"strikeout"},b=function(t,e){return e<0?t<=0:t>=l.frame.length-1},x=function(t,e){return t.b<=e.t||e.b<=t.t},C=function(t,e){var n,r=l.getCaretCoords(t);for(d=null!==h?h:r.l;!b(t,e)&&(t+=e,n=l.getCaretCoords(t),!x(n,r)););for(r=n;!b(t,e)&&!(e>0&&n.l>=d||e<0&&n.l<=d);)if(t+=e,n=l.getCaretCoords(t),x(n,r)){t-=e;break}return t},_=function(t,e){for(var n,r=l.getCaretCoords(t);!b(t,e);)if(t+=e,n=l.getCaretCoords(t),x(n,r)){t-=e;break}return t},E=function(t,e,n){var r=l.selection.start,i=l.selection.end,o=l.frame.length-1,a=!1;if(d=null,e){if(!f)switch(t){case 37:case 38:case 36:case 33:f=-1;break;case 39:case 40:case 35:case 34:f=1}}else f=0;var s=1===f?i:r,u=!1;switch(t){case 37:if(e||r==i){if(s>0)if(n)s=(c=l.wordContainingOrdinal(s)).ordinal===s?c.index>0?l.wordOrdinal(c.index-1):0:c.ordinal;else s--}else s=r;u=!0;break;case 39:var c;if(e||r==i){if(s<o)if(n)s=(c=l.wordContainingOrdinal(s)).ordinal+c.word.length;else s++}else s=i;u=!0;break;case 40:s=C(s,1),u=!0;break;case 38:s=C(s,-1),u=!0;break;case 36:s=_(s,-1),u=!0;break;case 35:s=_(s,1),u=!0;break;case 33:s=0,u=!0;break;case 34:s=o,u=!0;break;case 8:r===i&&r>0&&(l.range(r-1,r).clear(),v=r-1,l.select(v,v),a=!0);break;case 46:r===i&&r<o&&(l.range(r,r+1).clear(),a=!0);break;case 90:n&&(a=!0,l.performUndo());break;case 89:n&&(a=!0,l.performUndo(!0));break;case 65:n&&(a=!0,l.select(0,o));break;case 67:case 88:n&&(m=l.selectedRange().save(),y=l.selectedRange().plainText())}var p=w[t];if(n&&p){var g=l.selectedRange();g.setFormatting(p,!0!==g.getFormatting()[p]),k(),a=!0}if(u){switch(f){case 0:r=i=s;break;case-1:r=s;break;case 1:i=s}if(r===i)f=0;else if(r>i){f=-f;var b=i;i=r,r=b}v=s,l.select(r,i),a=!0}return h=d,a};i.handleEvent(c,"keydown",(function(t){if(E(t.keyCode,t.shiftKey,t.ctrlKey))return!1}));var O="top";l.setVerticalAlignment=function(t){O=t,k()};var k=function(){var n=1*t.clientWidth;l.width()!==n&&l.width(n);var r=l.frame.bounds().h,i=Math.max(1,window.devicePixelRatio||1),u=Math.max(l.frame.actualWidth(),t.clientWidth),f=t.clientHeight;a.width=i*u,a.height=i*f,a.style.width=u+"px",a.style.height=f+"px",a.style.top=t.scrollTop+"px",s.style.width=u+"px",s.style.height=Math.max(r,t.clientHeight)+"px",r<t.clientHeight-50&&l.frame.actualWidth()<=n?t.style.overflow="hidden":t.style.overflow="auto";var h=a.getContext("2d");h.scale(i,i),h.clearRect(0,0,u,f),h.translate(0,e()-t.scrollTop),l.draw(h,o(0,t.scrollTop,u,f)),l.drawSelection(h,p||document.activeElement===c)};i.handleEvent(t,"scroll",k),i.handleEvent(c,"input",(function(){var t=c.value;g!=t&&(g="",c.value="",t===y&&(t=m),l.insert(t))}));var T=function(){v=null===v?l.selection.end:v;var e=l.byOrdinal(v);if(v=null,e){var n=e.bounds();u.style.left=n.l+"px",u.style.top=n.t+"px",c.focus();var r=Math.max(0,n.t+n.h-(t.scrollTop+t.clientHeight));r&&(t.scrollTop+=r);var i=Math.max(0,t.scrollTop-n.t);i&&(t.scrollTop-=i);var o=Math.max(0,n.l-(t.scrollLeft+t.clientWidth));o&&(t.scrollLeft+=o);var a=Math.max(0,t.scrollLeft-n.l);a&&(t.scrollLeft-=a)}g=l.selectedRange().plainText(),c.value=g,c.select(),setTimeout((function(){c.focus()}),10)};l.selectionChanged((function(t,e){k(),p||!1!==e&&T()})),n("mousedown",(function(t){p=t.ordinal,l.select(t.ordinal,t.ordinal),h=null})),n("dblclick",(function(t){(t=t.parent())&&l.select(t.ordinal,t.ordinal+(t.word?t.word.text.length:t.length))})),n("mousemove",(function(t){null!==p&&t&&(v=t.ordinal,p>t.ordinal?l.select(t.ordinal,p):l.select(p,t.ordinal))})),n("mouseup",(function(){p=null,h=null,T(),c.focus()}));var j=(new Date).getTime(),M=!1,A=t.clientWidth,S=t.clientHeight,R=function(){var e=!1,n=document.activeElement===c;M!==n&&(M=n,e=!0);var r=(new Date).getTime();r>j&&(j=r+500,l.toggleCaret()&&(e=!0)),t.clientWidth===A&&t.clientHeight===S||(e=!0,A=t.clientWidth,S=t.clientHeight),e&&k()};return i.handleEvent(a,"carotaEditorSharedTimer",R),R(),l.sendKey=E,l}},"frame.js":function(t,e,n){var r=n("./node"),i=n("./wrap"),o=n("./rect"),a=r.derive({bounds:function(){if(!this._bounds){var t=0,e=0,n=0,r=0;if(this.lines.length){var i=this.lines[0].bounds();t=i.l,e=i.t,this.lines.forEach((function(t){var e=t.bounds();n=Math.max(n,e.l+e.w),r=Math.max(r,e.t+e.h)}))}this._bounds=o(t,e,n-t,this.height||r-e)}return this._bounds},actualWidth:function(){if(!this._actualWidth){var t=0;this.lines.forEach((function(e){"number"==typeof e.actualWidth&&(t=Math.max(t,e.actualWidth))})),this._actualWidth=t}return this._actualWidth},children:function(){return this.lines},parent:function(){return this._parent},draw:function(t,e){var n=e?e.t:0,r=e?e.t+e.h:Number.MAX_VALUE;this.lines.some((function(i){var o=i.bounds();return!(o.t+o.h<n)&&(o.t>r||void i.draw(t,e))}))},type:"frame"});e.exports=function(t,e,n,r,o,s,u,c){var l=[],f=Object.create(a,{lines:{value:l},_parent:{value:o},ordinal:{value:r}}),h=i(t,e,n,r,f,s,u,c),d=0,p=0;return function(t,e){if(h((function(t){"number"==typeof t?p=t:(d=t.ordinal+t.length-r,l.push(t))}),e))return Object.defineProperty(f,"length",{value:d}),Object.defineProperty(f,"height",{value:p}),t(f),!0}}},"html.js":function(t,e,n){var r=n("./runs"),i=n("per"),o=function(t,e){return function(n,r){n.nodeName===t&&(r[e]=!0)}},a=function(t,e,n,r){return function(i,o){var a=i[t]&&i[t][e];a&&(r&&(a=r(a)),o[n]=a)}},s=function(t,e,n){return a("attributes",t,e,n)},u=function(t,e,n){return a("style",t,e,n)},c=function(t,e,n){return function(r,i){r.style&&r.style[t]===e&&(i[n]=!0)}},l=[6,7,9,10,12,16,20,30],f={left:!0,center:!0,right:!0,justify:!0},h=function(t){return f[t]?t:"left"},d=function(t){var e=t.split(/\s*,\s*/g);if(0==e.length)return t;var n=(t=e[0]).match(/^"(.*)"$/);return n||(n=t.match(/^'(.*)'$/))?n[1].trim():t},p={H1:30,H2:20,H3:16,H4:14,H5:12},v=[o("B","bold"),o("STRONG","bold"),o("I","italic"),o("EM","italic"),o("U","underline"),o("S","strikeout"),o("STRIKE","strikeout"),o("DEL","strikeout"),c("fontWeight","bold","bold"),c("fontStyle","italic","italic"),c("textDecoration","underline","underline"),c("textDecoration","line-through","strikeout"),u("color","color"),u("fontFamily","font",d),u("fontSize","size",(function(t){var e=t.match(/^([\d\.]+)pt$/);return e?parseFloat(e[1]):10})),u("textAlign","align",h),function(t,e){"SUB"===t.nodeName&&(e.script="sub")},function(t,e){"SUPER"===t.nodeName&&(e.script="super")},function(t,e){"CODE"===t.nodeName&&(e.font="monospace")},function(t,e){var n=p[t.nodeName];n&&(e.size=n)},s("color","color"),s("face","font",d),s("align","align",h),s("size","size",(function(t){return l[t]||10}))],g={};["BR","P","H1","H2","H3","H4","H5"].forEach((function(t){g[t]=!0})),t.parse=function(t,e){function n(t,r){if(3==t.nodeType)l(t.nodeValue,r);else{r=Object.create(r);var i=t.attributes.class;if(i&&i.value.split(" ").forEach((function(t){(t=e[t])&&Object.keys(t).forEach((function(e){r[e]=t[e]}))})),v.forEach((function(e){e(t,r)})),t.childNodes)for(var o=0;o<t.childNodes.length;o++)n(t.childNodes[o],r);g[t.nodeName]&&(c("\n",r),s=!0)}}var o=t;"string"==typeof o&&((o=document.createElement("div")).innerHTML=t);var a=[],s=!0,u=i(r.consolidate()).into(a),c=function(t,e){u.submit(Object.create(e,{text:{value:t}}))},l=function(t,e){var n=(t=t.replace(/\n+\s*/g," ")).length;t=t.replace(/^\s+/,""),s?s=!1:n!==t.length&&(t=" "+t),(n=t.length)!==(t=t.replace(/\s+$/,"")).length&&(s=!0,t+=" "),c(t,e)};return n(o,{}),a}},"line.js":function(t,e,n){var r=n("./positionedword"),i=n("./rect"),o=n("./node"),a=(n("./runs"),o.derive({bounds:function(t){if(t){var e=this.first().bounds(),n=this.last().bounds();return i(e.l,this.baseline-this.ascent,n.l+n.w-e.l,this.ascent+this.descent)}return i(this.left,this.baseline-this.ascent,this.width,this.ascent+this.descent)},parent:function(){return this.doc},children:function(){return this.positionedWords},type:"line"}));e.exports=function(t,e,n,i,o,s,u,c){var l=u[0].align(),f=Object.create(a,{doc:{value:t},left:{value:e},width:{value:n},baseline:{value:i},ascent:{value:o},descent:{value:s},ordinal:{value:c},align:{value:l}}),h=0;u.forEach((function(t){h+=t.width})),h-=u[u.length-1].space.width;var d=0,p=0;if(h<n)switch(l){case"right":d=n-h;break;case"center":d=(n-h)/2;break;case"justify":u.length>1&&!u[u.length-1].isNewLine()&&(p=(n-h)/(u.length-1))}return Object.defineProperty(f,"positionedWords",{value:u.map((function(t){var e=d;d+=t.width+p;var n=c;return c+=t.text.length+t.space.length,r(t,f,e,n,t.width+p)}))}),Object.defineProperty(f,"actualWidth",{value:h}),Object.defineProperty(f,"length",{value:c-f.ordinal}),f}},"node.js":function(t,e,n){n("per"),n("./runs");var r=n("./rect"),i=n("./util");t.prototype={children:function(){return[]},parent:function(){return null},first:function(){return this.children()[0]},last:function(){return this.children()[this.children().length-1]},next:function(){for(var t=this;;){var e=t.parent();if(!e)return null;var n=e.children(),r=n[n.indexOf(t)+1];if(r){for(;;){var i=r.first();if(!i)break;r=i}return r}t=e}},previous:function(){var t=this.parent();if(!t)return null;var e=t.children(),n=e[e.indexOf(this)-1];if(n)return n;var r=t.previous();return r?r.last():null},byOrdinal:function(t){var e=null;return this.children().some((function(n){if(t>=n.ordinal&&t<n.ordinal+n.length&&(e=n.byOrdinal(t)))return!0}))?e:this},byCoordinate:function(t,e){var n;if(this.children().some((function(r){if(r.bounds().contains(t,e)&&(n=r.byCoordinate(t,e)))return!0})),!n){for(n=this.last();n;){var r=n.last();if(!r)break;n=r}var i=n.next();i&&i.block&&(n=i)}return n},draw:function(t,e){this.children().forEach((function(n){n.draw(t,e)}))},parentOfType:function(t){var e=this.parent();return e&&(e.type===t?e:e.parentOfType(t))},bounds:function(){var t=this._left,e=this._top,n=0,i=0;return this.children().forEach((function(r){var o=r.bounds();t=Math.min(t,o.l),e=Math.min(e,o.t),n=Math.max(n,o.l+o.w),i=Math.max(i,o.t+o.h)})),r(t,e,n-t,i-e)}},t.derive=function(e){return i.derive(t.prototype,e)};var o=t.derive({children:function(){return this._children},parent:function(){return this._parent},finalize:function(t,e){var n=Number.MAX_VALUE,r=0;this._children.forEach((function(t){n=Math.min(n,t.ordinal),r=Math.max(r,t.ordinal+t.length)})),Object.defineProperty(this,"ordinal",{value:n-(t||0)}),Object.defineProperty(this,"length",{value:(e||0)+r-n})}});t.generic=function(t,e,n,r){return Object.create(o,{type:{value:t},_children:{value:[]},_parent:{value:e},_left:{value:"number"==typeof n?n:Number.MAX_VALUE},_top:{value:"number"==typeof r?r:Number.MAX_VALUE}})}},"part.js":function(t,e,n){var r=n("./text"),i={measure:function(t){var e=e.measure("?",t);return{width:e.width+4,ascent:e.width+2,descent:e.width+2}},draw:function(t,e,n,r,i,o){t.fillStyle="silver",t.fillRect(e,n-i,r,i+o),t.strokeRect(e,n-i,r,i+o),t.fillStyle="black",t.fillText("?",e+2,n)}},o={draw:function(t,e,n){"string"==typeof this.run.text?r.draw(t,this.run.text,this.run,e,n,this.width,this.ascent,this.descent):this.code&&this.code.draw&&(t.save(),this.code.draw(t,e,n,this.width,this.ascent,this.descent,this.run),t.restore())}};e.exports=function(t,e){var n,a,s;"string"==typeof t.text?(a=1===t.text.length&&"\n"===t.text[0],n=r.measure(a?r.nbsp:t.text,t)):n=(s=e(t.text)||i).measure?s.measure(t):{width:0,ascent:0,descent:0};var u=Object.create(o,{run:{value:t},isNewLine:{value:a},width:{value:a?0:n.width},ascent:{value:n.ascent},descent:{value:n.descent}});return s&&Object.defineProperty(u,"code",{value:s}),u}},"positionedword.js":function(t,e,n){var r=n("./rect"),i=n("./part"),o=n("./text"),a=n("./node"),s=(n("./word"),n("./runs")),u=function(t){return o.measure(o.enter,t).width},c=a.derive({bounds:function(){var t=this.word.bounds(),e=this.word.word.isNewLine()?u(this.word.word.run):this.width||this.part.width;return r(t.l+this.left,t.t,e,t.h)},parent:function(){return this.word},byOrdinal:function(){return this},byCoordinate:function(t){return t<=this.bounds().center().x?this:this.next()},type:"character"}),l=a.derive({draw:function(t){this.word.draw(t,this.line.left+this.left,this.line.baseline)},bounds:function(){return r(this.line.left+this.left,this.line.baseline-this.line.ascent,this.word.isNewLine()?u(this.word.run):this.width,this.line.ascent+this.line.descent)},parts:function(t){this.word.text.parts.some(t)||this.word.space.parts.some(t)},realiseCharacters:function(){if(!this._characters){var t=[],e=0,n=this,r=this.ordinal,o=this.parentOfType("document").codes;this.parts((function(a){s.pieceCharacters((function(s){var u=Object.create(a.run);u.text=s;var l=i(u,o);t.push(Object.create(c,{left:{value:e},part:{value:l},word:{value:n},ordinal:{value:r},length:{value:1}})),e+=l.width,r++}),a.run.text)}));var a=t[t.length-1];a&&(Object.defineProperty(a,"width",{value:this.width-a.left}),(this.word.isNewLine()||this.word.code()&&this.word.code().eof)&&Object.defineProperty(a,"newLine",{value:!0})),this._characters=t}},children:function(){return this.realiseCharacters(),this._characters},parent:function(){return this.line},type:"word"});e.exports=function(t,e,n,r,i){return Object.create(l,{word:{value:t},line:{value:e},left:{value:n},width:{value:i},ordinal:{value:r},length:{value:t.text.length+t.space.length}})}},"range.js":function(t,e,n){function r(t,e,n){this.doc=t,this.start=e,this.end=n,e>n&&(this.start=n,this.end=e)}var i=n("per"),o=n("./runs");r.prototype.parts=function(t,e){e=e||this.doc.children();var n=this;e.some((function(e){return!(e.ordinal+e.length<=n.start)&&(e.ordinal>=n.end||void(e.ordinal>=n.start&&e.ordinal+e.length<=n.end?t(e):n.parts(t,e.children())))}))},r.prototype.clear=function(){return this.setText([])},r.prototype.setText=function(t){return this.doc.splice(this.start,this.end,t)},r.prototype.runs=function(t){this.doc.runs(t,this)},r.prototype.plainText=function(){return i(this.runs,this).map(o.getPlainText).all().join("")},r.prototype.save=function(){return i(this.runs,this).per(o.consolidate()).all()},r.prototype.getFormatting=function(){var t=this;if(t.start===t.end){var e=t.start;e>0&&e--,t.start=e,t.end=e+1}return i(t.runs,t).reduce(o.merge).last()||o.defaultFormatting},r.prototype.setFormatting=function(t,e){var n=this;if("align"===t&&(n=n.doc.paragraphRange(n.start,n.end)),n.start===n.end)n.doc.modifyInsertFormatting(t,e);else{var r=n.save(),i={};i[t]=e,o.format(r,i),n.setText(r)}},e.exports=function(t,e,n){return new r(t,e,n)}},"rect.js":function(t,e){var n={contains:function(t,e){return t>=this.l&&t<this.l+this.w&&e>=this.t&&e<this.t+this.h},stroke:function(t){t.strokeRect(this.l,this.t,this.w,this.h)},fill:function(t){t.fillRect(this.l,this.t,this.w,this.h)},offset:function(t,e){return r(this.l+t,this.t+e,this.w,this.h)},equals:function(t){return this.l===t.l&&this.t===t.t&&this.w===t.w&&this.h===t.h},center:function(){return{x:this.l+this.w/2,y:this.t+this.h/2}}},r=e.exports=function(t,e,r,i){return Object.create(n,{l:{value:t},t:{value:e},w:{value:r},h:{value:i},r:{value:t+r},b:{value:e+i}})}},"runs.js":function(t){t.formattingKeys=["bold","italic","underline","strikeout","color","font","size","align","script"],t.defaultFormatting={size:10,font:"sans-serif",color:"black",bold:!1,italic:!1,underline:!1,strikeout:!1,align:"left",script:"normal"},t.sameFormatting=function(e,n){return t.formattingKeys.every((function(t){return e[t]===n[t]}))},t.clone=function(e){var n={text:e.text};return t.formattingKeys.forEach((function(r){var i=e[r];i&&i!=t.defaultFormatting[r]&&(n[r]=i)})),n},t.multipleValues={},t.merge=function(e,n){if(1===arguments.length)return Array.isArray(e)?e.reduce(t.merge):e;if(arguments.length>2)return t.merge(Array.prototype.slice.call(arguments,0));var r={};return t.formattingKeys.forEach((function(i){(i in e||i in n)&&(e[i]===n[i]?r[i]=e[i]:r[i]=t.multipleValues)})),r},t.format=function(e,n){Array.isArray(e)?e.forEach((function(e){t.format(e,n)})):Object.keys(n).forEach((function(r){n[r]!==t.multipleValues&&(e[r]=n[r])}))},t.consolidate=function(){var e;return function(n,r){e&&t.sameFormatting(e,r)&&"string"==typeof e.text&&"string"==typeof r.text?e.text+=r.text:n(e=t.clone(r))}},t.getPlainText=function(e){if("string"==typeof e.text)return e.text;if(Array.isArray(e.text)){var n=[];return e.text.forEach((function(e){n.push(t.getPiecePlainText(e))})),n.join("")}return"_"},t.getPieceLength=function(t){return t.length||1},t.getPiecePlainText=function(t){return t.length?t:"_"},t.getTextLength=function(e){if("string"==typeof e)return e.length;if(Array.isArray(e)){var n=0;return e.forEach((function(e){n+=t.getPieceLength(e)})),n}return 1},t.getSubText=function(e,n,r,i){if(0!==i)if("string"!=typeof n)if(Array.isArray(n)){var o=0;n.some((function(n){if(i<=0)return!0;var a=t.getPieceLength(n);if(o+a>r)if(1===a)e(n),i-=1;else{var s=n.substr(Math.max(0,r-o),i);e(s),i-=s.length}o+=a}))}else e(n);else e(n.substr(r,i))},t.getTextChar=function(e,n){var r;return t.getSubText((function(t){r=t}),e,n,1),r},t.pieceCharacters=function(t,e){if("string"==typeof e)for(var n=0;n<e.length;n++)t(e[n]);else t(e)}},"split.js":function(t,e){e.exports=function(t){var e=null,n=null,r=!0;return function(i,o){var a;if(null===o.char)a=!0;else if(r&&(a=!0,r=!1),"string"==typeof o.char)switch(o.char){case" ":n||(n=o);break;case"\n":a=!0,r=!0;break;default:n&&(a=!0)}else{var s=t(o.char);(s.block||s.eof)&&(a=!0,r=!0)}if(a){if(e&&!e.equals(o)){if(!1===i({text:e,spaces:n||o,end:o}))return!1;n=null}null===o.char&&i(null),e=o}}}},"text.js":function(t,e,n){var r=n("./runs"),i=t.getFontString=function(t){var e=t&&t.size||r.defaultFormatting.size;if(t)switch(t.script){case"super":case"sub":e*=.8}return(t&&t.italic?"italic ":"")+(t&&t.bold?"bold ":"")+" "+e+"pt "+(t&&t.font||r.defaultFormatting.font)};t.applyRunStyle=function(t,e){t.fillStyle=e&&e.color||r.defaultFormatting.color,t.font=i(e)},t.prepareContext=function(t){t.textAlign="left",t.textBaseline="alphabetic"},t.getRunStyle=function(t){var e=["font: ",i(t),"; color: ",t&&t.color||r.defaultFormatting.color];if(t)switch(t.script){case"super":e.push("; vertical-align: super");break;case"sub":e.push("; vertical-align: sub")}return e.join("")};var o=t.nbsp=String.fromCharCode(160),a=(t.enter=o,t.measureText=function(t,e){var n,r,i;n=document.createElement("span"),r=document.createElement("div"),i=document.createElement("div"),r.style.display="inline-block",r.style.width="1px",r.style.height="0",i.style.visibility="hidden",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="500px",i.style.height="200px",i.appendChild(n),i.appendChild(r),document.body.appendChild(i);try{n.setAttribute("style",e),n.innerHTML="",n.appendChild(document.createTextNode(t.replace(/\s/g,o)));var a={};r.style.verticalAlign="baseline",a.ascent=r.offsetTop-n.offsetTop,r.style.verticalAlign="bottom",a.height=r.offsetTop-n.offsetTop,a.descent=a.height-a.ascent,a.width=n.offsetWidth}finally{i.parentNode.removeChild(i),i=null}return a}),s=t.createCachedMeasureText=function(){var t={};return function(e,n){var r=n+"<>!&%"+e,i=t[r];return i||(t[r]=i=a(e,n)),i}};t.cachedMeasureText=s(),t.measure=function(e,n){return t.cachedMeasureText(e,t.getRunStyle(n))},t.draw=function(e,n,r,i,o,a,s,u){switch(t.prepareContext(e),t.applyRunStyle(e,r),r.script){case"super":o-=s*(1/3);break;case"sub":o+=u/2}
e.fillText("\n"===n?t.enter:n,i,o),r.underline&&e.fillRect(i,1+o,a,1),r.strikeout&&e.fillRect(i,1+o-s/2,a,1)}},"util.js":function(t){t.event=function(){var t=[],e=function(e){t.push(e)};return e.fire=function(){var e=Array.prototype.slice.call(arguments,0);t.forEach((function(t){t.apply(null,e)}))},e},t.derive=function(t,e){var n={};return Object.keys(e).forEach((function(t){n[t]={value:e[t]}})),Object.create(t,n)}},"word.js":function(t,e,n){var r=n("per"),i=n("./part"),o=n("./runs"),a={isNewLine:function(){return 1==this.text.parts.length&&this.text.parts[0].isNewLine},code:function(){return 1==this.text.parts.length&&this.text.parts[0].code},codeFormatting:function(){return 1==this.text.parts.length&&this.text.parts[0].run},draw:function(t,e,n){r(this.text.parts).concat(this.space.parts).forEach((function(r){r.draw(t,e,n),e+=r.width}))},plainText:function(){return this.text.plainText+this.space.plainText},align:function(){var t=this.text.parts[0];return t?t.run.align:"left"},runs:function(t,e){var n=e&&e.start||0,r=e&&e.end;"number"!=typeof r&&(r=Number.MAX_VALUE),[this.text,this.space].forEach((function(e){e.parts.some((function(e){if(n>=r||r<=0)return!0;var i=e.run,o=i.text;if("string"==typeof o){if(n<=0&&r>=o.length)t(i);else if(n<o.length){var a=Object.create(i),s=Math.max(0,n);a.text=o.substr(s,Math.min(o.length,r-s)),t(a)}n-=o.length,r-=o.length}else n<=0&&r>=1&&t(i),n--,r--}))}))}},s=function(t,e){var n={parts:r(t).map((function(t){return i(t,e)})).all(),ascent:0,descent:0,width:0,length:0,plainText:""};return n.parts.forEach((function(t){n.ascent=Math.max(n.ascent,t.ascent),n.descent=Math.max(n.descent,t.descent),n.width+=t.width,n.length+=o.getPieceLength(t.run.text),n.plainText+=o.getPiecePlainText(t.run.text)})),n};e.exports=function(t,e){var n,r;t?(n=t.text.cut(t.spaces),r=t.spaces.cut(t.end)):(n=[{text:"\n"}],r=[]),n=s(n,e),r=s(r,e);var i=Object.create(a,{text:{value:n},space:{value:r},ascent:{value:Math.max(n.ascent,r.ascent)},descent:{value:Math.max(n.descent,r.descent)},width:{value:n.width+r.width,configurable:!0},length:{value:n.length+r.length}});return t||Object.defineProperty(i,"eof",{value:!0}),i}},"wrap.js":function(t,e,n){var r=n("./line");e.exports=function(t,e,n,i,o,a,s,u){var c,l=[],f=0,h=s||0,d=u||0,p=0,v=e,g=function(t,e){l.push(t),f+=t.width,h=Math.max(h,t.ascent),d=Math.max(d,t.descent),t.isNewLine()&&(m(e),p=t.ascent+t.descent)},m=function(e){if(!c&&0!==l.length){var a=r(o,t,n,v+h,h,d,l,i);i+=a.length,c=e(a),v+=h+d,l.length=0,f=h=d=0}},y=null;return function(r,s){if(y){p=0;var u=y(s);u&&(y=null,i+=u.length,v+=u.bounds().h,Object.defineProperty(u,"block",{value:!0}),r(u))}else{var h=s.code();h&&h.block?(l.length?m(r):v+=p,y=h.block(t,v,n,i,o,s.codeFormatting()),p=0):h&&h.eof||s.eof?((!h||a&&a(h))&&g(s,r),l.length?(m(r),r(v-e)):r(v+p-e),c=!0):(p=0,l.length?(f+s.text.width>n&&m(r),g(s,r)):g(s,r))}return c}}}}},per:{":mainpath:":"per.js","per.js":function(t,e){!function(t){function e(t,e){return"function"!=typeof t?Array.isArray(t)?function(e){return t.some(e)}:function(e){return e(t)}:e?function(n,r){t.call(e,n,r)}:t}function n(t,n){this.forEach=e(t,n)}function r(t,e){t(e)}function i(t,e){return 0===arguments.length?new n(r):t&&t instanceof n?t:new n(t,e)}function o(t){return"string"==typeof t?new Function("x","return "+t):t}function a(t){return"number"!=typeof t?Number.MAX_VALUE:t}function s(t,e){var n=t[e];return"function"==typeof n?n:function(n){t[e]=n}}function u(){}function c(t){return!!t}function l(t,e){return Math.min(t,e)}function f(t,e){return Math.max(t,e)}function h(t,e){return t+e}function d(t,e){return!(!t||!e)}function p(t,e){return!(!t&&!e)}function v(t){return!t}n.prototype.per=function(t,n){var r=this.forEach,o=e(t&&t.forEach||t,n);return i((function(t,e){return r((function(e){return o(t,e)}),e)}))},n.prototype.map=function(t){return t=o(t),this.per((function(e,n){return e(t(n))}))},n.prototype.filter=function(t){return t=o(t),this.per((function(e,n){if(t(n))return e(n)}))},n.prototype.concat=function(t,r){t=t instanceof n?t.forEach:e(t,r);var o=this.forEach;return i((function(e,n){o(e,n),t(e,n)}))},n.prototype.skip=function(t){return this.per((function(e,n){return t>0?(t--,!1):e(n)}))},n.prototype.take=function(t){return this.per((function(e,n){return t<=0||(t--,e(n))}))},n.prototype.listen=function(t){return this.per((function(e,n){return!!t(n)||e(n)}))},n.prototype.flatten=function(){return this.per((function(t,e){return Array.isArray(e)?e.some((function(e){return t(e)})):t(e)}))},n.prototype.reduce=function(t,e){var n=e,r=2==arguments.length;return this.per((function(e,i){e(n=r?t(n,i):i),r=!0}))},n.prototype.multicast=function(t){return 1!==arguments.length&&(t=Array.prototype.slice.call(arguments,0)),t=t.map((function(t){return"function"==typeof t?t:t instanceof n?t.forEach:u})),this.listen((function(e){var n=!0;return t.forEach((function(t){t(u,e)||(n=!1)})),n}))},n.prototype.into=function(t,e){if(!Array.isArray(t))throw new Error("into expects an array");return e=a(e),this.listen((function(n){if(e<=0)return!0;t.push(n),e--}))},n.prototype.monitor=function(t){var e=0,n=s(t,"count"),r=s(t,"first"),i=s(t,"last"),o=t.limit;return"number"!=typeof o&&(o=Number.MAX_VALUE),o<1?this:this.listen((function(t){if(0===e&&r(t),e++,n(e),i(t),e>=o)return!0}))},n.prototype.submit=function(t){return this.forEach(u,t)},n.prototype.all=function(){var t=[];return this.into(t).submit(),t},n.prototype.first=function(){var t={limit:1};return this.monitor(t).submit(),t.count>0?t.first:void 0},n.prototype.last=function(){var t={};return this.monitor(t).submit(),t.count>0?t.last:void 0},n.prototype.truthy=function(){return this.filter(c)},n.prototype.min=function(){return this.reduce(l,Number.MAX_VALUE)},n.prototype.max=function(){return this.reduce(f,Number.MIN_VALUE)},n.prototype.sum=function(){return this.reduce(h,0)},n.prototype.and=function(){return this.reduce(d,!0)},n.prototype.or=function(){return this.reduce(p,!1)},n.prototype.not=function(){return this.map(v)},i.pulse=function(t){var e=0;return i((function(n){function r(){!0!==n(e++)&&setTimeout(r,t)}r()}))},t(i)}((function(n){void 0===t?this.per=n:e.exports=n}))}}})("carota/src/carota");