function touchArray(e){for(var t=[],n=0;n<e.length;n++)t.push({pageX:e[n].pageX,pageY:e[n].pageY});return t}function log(){}function main(){function e(e,t,n){var a=new THREE.Quaternion;a.setFromAxisAngle(t,n),e.multiply(a)}function t(){o*=.95,a*=.95,r*=.95,n.multiplyScalar(.97),e(y,S,o),e(y,X,a),e(y,Y,r),R.rotation.setFromQuaternion(y),R.position.add(n),w.rotation.copy(R.rotation),w.position.copy(R.position),requestAnimationFrame(t);var s=c.clientWidth,l=c.clientHeight,h=s-(T+10),E=l-(T+10);p.setViewport(0,10,s,l),p.setScissor(0,10,s,l),p.clear(),w.visible=!1,p.render(i,R),p.setViewport(h,E,T,T),p.setScissor(h,E,T,T),p.clear(),w.visible=!0,p.render(i,f)}var n=new THREE.Vector3(0,0,0),a=0,o=0,r=0,i=new THREE.Scene,s=new THREE.HemisphereLight(16777215,1,1);s.position.set(0,1,1),i.add(s);var c=document.querySelector(".viewport"),p=new THREE.WebGLRenderer;p.setClearColor(0,1),p.setSize(c.clientWidth,c.clientHeight),p.autoClear=!1,c.appendChild(p.domElement);for(var l=new THREE.MeshPhongMaterial({ambient:197379,color:14540253,specular:153,shininess:30,shading:THREE.FlatShading}),h=10,E=-h;E<h;E++)for(var u=-h;u<h;u++){var d=.2+2.5*Math.random(),v=new THREE.BoxGeometry(.2,d,.2),g=new THREE.Mesh(v,l);g.position.x=E,g.position.y=d/2-2,g.position.z=u,i.add(g)}var m=[0,0,-1,-1,-.3,1,0,.6,1,1,-.3,1],H=[2,1,0,0,3,2,1,3,0,2,3,1],w=new THREE.Mesh(new THREE.PolyhedronGeometry(m,H,2,0),l);i.add(w);var R=new THREE.PerspectiveCamera(75,c.clientWidth/c.clientHeight,.1,1e3);R.position.z=5;var T=300,f=new THREE.PerspectiveCamera(75,1,.1,1e3);f.position.z=30,f.position.y=10,p.enableScissorTest(!0);var y=new THREE.Quaternion;y.setFromEuler(R.rotation);var M,S=new THREE.Vector3(0,0,-1),X=new THREE.Vector3(-1,0,0),Y=new THREE.Vector3(0,-1,0);document.addEventListener("touchstart",(function(e){e.preventDefault();var t=touchArray(e.touches);log(t,"start"),M=t})),document.addEventListener("touchend",(function(e){e.preventDefault(),M=null})),document.addEventListener("touchmove",(function(e){e.preventDefault();var t=touchArray(e.touches),i="move";if(M&&M.length==e.touches.length)switch(t.length){case 1:var s=M[0],c=t[0],p=c.pageX-s.pageX,l=c.pageY-s.pageY,h=1e-4;r-=p*h,a-=l*h,i=p+", "+l;break;case 2:var E=M[0],u=t[0],d=M[1],v=t[1],g=E.pageX-d.pageX,m=E.pageY-d.pageY,H=u.pageX-v.pageX,w=u.pageY-v.pageY,R=Math.atan2(m,g),T=Math.atan2(w,H),f=Math.sqrt(g*g+m*m),S=Math.sqrt(H*H+w*w);i=R+", "+T+" = "+(T-R);var X=T-R;Math.abs(X)>Math.PI&&(X>0?X-=2*Math.PI:X+=2*Math.PI),o-=.05*X;var Y=new THREE.Vector3(0,0,-2e-4*(S-f));Y.applyQuaternion(y),n.add(Y)}log(t,i),M=t})),t()}