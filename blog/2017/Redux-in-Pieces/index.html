<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Redux in Pieces | Daniel Earwicker </title> <meta name="author" content="Daniel Earwicker"> <meta name="description" content="You are almost certainly lost on the Internet. "> <meta name="keywords" content="coding, physics"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?754e6b58bcf99910aed4f8d8638bd47f"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://danielearwicker.github.io/blog/2017/Redux-in-Pieces/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Daniel</span> Earwicker </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Redux in Pieces</h1> <p class="post-meta"> Created on January 28, 2017 </p> <p class="post-tags"> <a href="/blog/2017"> <i class="fa-solid fa-calendar fa-sm"></i> 2017 </a>   ·   <a href="/blog/tag/javascript"> <i class="fa-solid fa-hashtag fa-sm"></i> javascript</a>   <a href="/blog/tag/immutability"> <i class="fa-solid fa-hashtag fa-sm"></i> immutability</a>   <a href="/blog/tag/functional"> <i class="fa-solid fa-hashtag fa-sm"></i> functional</a>   <a href="/blog/tag/redux"> <i class="fa-solid fa-hashtag fa-sm"></i> redux</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Last July I noted down my thoughts on <a href="../../2016/Good-Redux">Redux</a> with some hints of the concerns that eventually led to <a href="../../2016/Immuto/">Immuto</a>.</p> <p>I’ve since rediscovered my love of <code class="language-plaintext highlighter-rouge">observable</code> and <code class="language-plaintext highlighter-rouge">computed</code> via <a href="../../2016/MobX">MobX</a>, which is like the good parts of <a href="http://knockoutjs.com" rel="external nofollow noopener" target="_blank">Knockout.js</a> made even better by a very careful, thoughtful implementation.</p> <p>Even so, this is <em>not</em> the same thing as abandoning immutability and purity. There’s nothing stopping you using those techniques within a system of observables. Indeed <a href="https://github.com/danielearwicker/bidi-mobx" rel="external nofollow noopener" target="_blank">bidi-mobx</a> abstracts away all mutation and allows entire UIs to be declared from pure expressions. The data transformation is carried out by objects called adaptors that contain pairs of <em>pure</em> functions between <code class="language-plaintext highlighter-rouge">View</code> and <code class="language-plaintext highlighter-rouge">Model</code> representations. Only the user gets to do mutation!</p> <p>What is the advantage of modelling change through immutability? Primarily it’s to allow the different versions of the state to co-exist. One part of your application can refer to an old version even as another is working from a new version. Sometimes this is what you want (an undo stack keeps old versions). Other times it’s not (you’re concerned mostly about data consistency and you want all parts of your app to be on the same page). Also it’s worth remembering that old versions can be retained by cloning, so immutability is not the only way to retain history.</p> <p>Consider React: every time you return a new UI structure from <code class="language-plaintext highlighter-rouge">render</code>, it compares it with the structure you returned last time and so is able to mutate the DOM accordingly. Imagine flipping this around. In your code, right after you mutate your data structure, you ask a library to take a <code class="language-plaintext highlighter-rouge">snapshot</code>. The library walks your current data to create a deep clone of it, compares it with the clone it made last time, and saves a succinct statement of the <em>differences</em> in its history stack. This, after all, is what a log of actions is: an ordered sequence of instructions for how to mutate the data in little steps. So it’s like the library is watching you mutate your data and automatically recording a description of each mutation (at snapshot boundaries), which allows you to visit all historic states (i.e. “undo”) whenever you need to construct them. It’s more expensive at runtime, but it may also be much easier to write your app, and remember Jackson’s Rules of Optimisation:</p> <ol> <li>Don’t.</li> <li> <em>(for experts)</em> Don’t <em>yet</em>.</li> </ol> <p>My point is that immutability is just a tool for achieving something, and there are other ways. It depends what you want to make easy or fast. This varies depending on the application.</p> <p>But anyway, (partly) as a joke I wrote down a minimal Redux implemented over MobX so I wouldn’t need a <code class="language-plaintext highlighter-rouge">subscribe</code> method:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">observable</span><span class="p">,</span> <span class="nx">runInAction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">mobx</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// An action has a string property called type</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">Action</span><span class="o">&lt;</span><span class="nx">Type</span> <span class="kd">extends</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">readonly</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Type</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Reducer evolves state as instructed by an action</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">Reducer</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">State</span><span class="p">;</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">Store</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">getState</span><span class="p">():</span> <span class="nx">State</span><span class="p">;</span>
    <span class="nf">dispatch</span><span class="p">(</span><span class="na">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Stores a State value and uses reducer that accepts Action (typically a union of Action&lt;T&gt; variants)</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nf">createStore</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nx">init</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span>
    <span class="nx">reducer</span><span class="p">:</span> <span class="nx">Reducer</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">.</span><span class="nx">shallowBox</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">init</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nf">getState</span><span class="p">():</span> <span class="nx">State</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nf">get</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nf">dispatch</span><span class="p">(</span><span class="na">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">runInAction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nf">reducer</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nf">get</span><span class="p">(),</span> <span class="nx">action</span><span class="p">)));</span>
        <span class="p">},</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <p>It’s worth asking: what’s the advantage of actions being “pure data” (i.e. JSON-persistent)? Obviously its that they can be persisted and shipped elsewhere to be replayed. If you don’t need that (and I would hazard a guess that almost no apps using Redux rely on this capability at all) then you could toss it out.</p> <p>An action could be a function:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// An action evolves state:</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">Action</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">previousState</span><span class="p">:</span> <span class="nx">State</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">State</span><span class="p">;</span>
</code></pre></div></div> <p>Given a state, it returns a new state. It can do this however it wants. Crucially it’s not constrained at all so there is no enforcement of an invariant on the state. No problem:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// An invariant checks that a state is allowed:</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">Invariant</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">possibleState</span><span class="p">:</span> <span class="nx">State</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">boolean</span><span class="p">;</span>
</code></pre></div></div> <p>So a store is just:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">Store</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">getState</span><span class="p">():</span> <span class="nx">State</span><span class="p">;</span>
    <span class="nx">dispatch</span><span class="o">&lt;</span><span class="nx">A</span> <span class="kd">extends</span> <span class="nx">Action</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="na">action</span><span class="p">:</span> <span class="nx">A</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nf">createStore</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">init</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">invariant</span><span class="p">:</span> <span class="nx">Invariant</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">.</span><span class="nx">shallowBox</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">init</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="nf">getState</span><span class="p">():</span> <span class="nx">State</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nf">get</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">dispatch</span><span class="o">&lt;</span><span class="nx">A</span> <span class="kd">extends</span> <span class="nx">Action</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="na">action</span><span class="p">:</span> <span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">runInAction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">const</span> <span class="nx">possible</span> <span class="o">=</span> <span class="nf">action</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nf">get</span><span class="p">());</span>
                <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nf">invariant</span><span class="p">(</span><span class="nx">possible</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="nx">state</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">possible</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">},</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <p>So now the store is responsible for protecting the invariant. It doesn’t allow changes that break the invariant. Only valid states are allowed. But you can dispatch actions to get to allowed states by whatever route you want.</p> <p>After all, what operations are available on some state is not the issue. The issue is understanding what the invariant is, and enforcing it rigidly. The Redux action/reducer pattern does not capture this or enforce it. It’s up to the author of the reducer to impose consistency on themselves. Redux focuses on interpreting actions into updates on state, only because it introduces that problem by insisting that actions are pure JSON-able data (just in case that’s useful).</p> <p>Summary: think about what you actually need, and use the abstractions that aid you in achieving it.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Not yet regretting the time you've spent here?</h2> <p class="mb-2">Keep reading:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai3/">Poorly Structured Notes on AI Part 3</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai2/">Poorly Structured Notes on AI Part 2</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai1/">Poorly Structured Notes on AI Part 1</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/Prompt-Engineer/">How to become a prompt engineer</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/Time-reversible-events/">Time reversible events</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Daniel Earwicker. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>