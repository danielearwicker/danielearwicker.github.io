<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Immuto - Radical Unification | Daniel Earwicker </title> <meta name="author" content="Daniel Earwicker"> <meta name="description" content="You are almost certainly lost on the Internet. "> <meta name="keywords" content="coding, physics"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?754e6b58bcf99910aed4f8d8638bd47f"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://danielearwicker.github.io/blog/2016/Immuto-Radical-Unification/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Daniel</span> Earwicker </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Immuto - Radical Unification</h1> <p class="post-meta"> Created on September 22, 2016 </p> <p class="post-tags"> <a href="/blog/2016"> <i class="fa-solid fa-calendar fa-sm"></i> 2016 </a>   ·   <a href="/blog/tag/typescript"> <i class="fa-solid fa-hashtag fa-sm"></i> typescript</a>   <a href="/blog/tag/immuto"> <i class="fa-solid fa-hashtag fa-sm"></i> immuto</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p><a href="https://github.com/danielearwicker/immuto" rel="external nofollow noopener" target="_blank">Immuto</a> continues to evolve rapidly. To ensure that I comply with Semantic Versioning, in which major version 0 implies an unstable API, I’ve been making major breaking changes every day or so.</p> <p>The major shift since the first write-up is left-to-right cursor composition. Example - here’s the signature of a function that gets a book from a shelf:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">declare</span> <span class="kd">function</span> <span class="nf">getBook</span><span class="p">(</span><span class="nx">shelf</span><span class="p">:</span> <span class="nx">Shelf</span><span class="p">,</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">Book</span><span class="p">;</span>
</code></pre></div></div> <p>And here’s one that gets a shelf from a shop:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">declare</span> <span class="kd">function</span> <span class="nf">getShelf</span><span class="p">(</span><span class="nx">shop</span><span class="p">:</span> <span class="nx">Shop</span><span class="p">,</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">Shelf</span><span class="p">;</span>
</code></pre></div></div> <p>If we have a <code class="language-plaintext highlighter-rouge">shelfId</code> and a <code class="language-plaintext highlighter-rouge">bookId</code>, to go straight from shop to book:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">book</span> <span class="o">=</span> <span class="nf">getBook</span><span class="p">(</span><span class="nf">getShelf</span><span class="p">(</span><span class="nx">shop</span><span class="p">,</span> <span class="nx">shelfId</span><span class="p">),</span> <span class="nx">bookId</span><span class="p">);</span>
</code></pre></div></div> <p>Ugh. The nesting makes it confusing. This is why people like methods on objects:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">book</span> <span class="o">=</span> <span class="nx">shop</span><span class="p">.</span><span class="nf">getShelf</span><span class="p">(</span><span class="nx">shelfId</span><span class="p">).</span><span class="nf">getBook</span><span class="p">(</span><span class="nx">bookId</span><span class="p">);</span>
</code></pre></div></div> <p>That’s the clarity of left-to-right composition. In Immuto we have clean pure-data interfaces, and we declare actions on them and form them into reducers. One kind of action is called a <code class="language-plaintext highlighter-rouge">reference</code> and it builds a function that works a bit like <code class="language-plaintext highlighter-rouge">getBook</code> and <code class="language-plaintext highlighter-rouge">getShelf</code>, except it deals with cursors to data. So it suffered from the same nested composition ugliness.</p> <p>What we need, taking a leaf out of functional programming, is a piping operator. I’ve added a method called <code class="language-plaintext highlighter-rouge">$</code> to the <code class="language-plaintext highlighter-rouge">Cursor</code> interface, which means “look up”, and corresponds to the familiar <code class="language-plaintext highlighter-rouge">.</code> operator in many object orientated languages.</p> <p>So if my <code class="language-plaintext highlighter-rouge">Shop</code> has a collection <code class="language-plaintext highlighter-rouge">shelves</code> (of type <code class="language-plaintext highlighter-rouge">Shelves</code>) in which each item is a <code class="language-plaintext highlighter-rouge">Shelf</code>, and a <code class="language-plaintext highlighter-rouge">Shelf</code> has a collection <code class="language-plaintext highlighter-rouge">books</code> (of type <code class="language-plaintext highlighter-rouge">Books</code>) in which each item is a <code class="language-plaintext highlighter-rouge">Book</code>, I can get a cursor to a book like this:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">book</span> <span class="o">=</span> <span class="nx">shop</span>
    <span class="p">.</span><span class="nf">$</span><span class="p">(</span><span class="nx">Shop</span><span class="p">.</span><span class="nx">shelves</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">$</span><span class="p">(</span><span class="nx">Shelves</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="nx">shelfId</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">$</span><span class="p">(</span><span class="nx">Shelf</span><span class="p">.</span><span class="nx">books</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">$</span><span class="p">(</span><span class="nx">Books</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="nx">bookId</span><span class="p">));</span>
</code></pre></div></div> <p>It makes complicated manoeuvres pretty readable and logical. Each step is like:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">whatIGot</span><span class="p">.</span><span class="nf">$</span><span class="p">(</span><span class="nx">whatIWant</span><span class="p">);</span>
</code></pre></div></div> <p>So it’s easy to understand by analogy with the ordinary <code class="language-plaintext highlighter-rouge">.</code> operator, although a bit more syntactically noisy. It would be nice if I could implement the <code class="language-plaintext highlighter-rouge">[]</code> operator, and so get:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">book</span> <span class="o">=</span>
    <span class="nx">shop</span><span class="p">[</span><span class="nx">Shop</span><span class="p">.</span><span class="nx">shelves</span><span class="p">][</span><span class="nx">Shelves</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="nx">shelfId</span><span class="p">)][</span><span class="nx">Shelf</span><span class="p">.</span><span class="nx">books</span><span class="p">][</span><span class="nx">Books</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="nx">bookId</span><span class="p">)];</span>
</code></pre></div></div> <p>But indexers are very special in JavaScript and you can’t just implement them like any function.</p> <p>One other change I made yesterday which I’ve hinted at above is that I’ve ripped out the special treatment of collections. It was an unnecessary concept that needed special explanation, it was a bit too magical which made the explanation difficult, and it baked in too much functionality that you might not want. Not all collections need to support random access deletion, for example. Also there are fundamental difference between kinds of collections: if you delete item 4 from an array, you renumber items 5, 6, 7… whereas that doesn’t happen with a map. Do I hide that difference or let it leak out? These are all decisions I shouldn’t be taking.</p> <p>So now collections are just a data type with a reducer and some actions, same as anything else:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">Books</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="na">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">]:</span> <span class="nx">Book</span> <span class="p">};</span>

<span class="k">export</span> <span class="k">namespace</span> <span class="nx">Books</span> <span class="p">{</span>
    <span class="k">export</span> <span class="kd">const</span> <span class="nx">empty</span><span class="p">:</span> <span class="nx">Books</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">export</span> <span class="kd">const</span> <span class="nx">at</span> <span class="o">=</span> <span class="nf">objectByNumber</span><span class="p">(</span><span class="nx">Book</span><span class="p">);</span>
    <span class="k">export</span> <span class="kd">const</span> <span class="nx">reduce</span> <span class="o">=</span> <span class="nf">reducer</span><span class="p">(</span><span class="nx">empty</span><span class="p">).</span><span class="nf">action</span><span class="p">(</span><span class="nx">at</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>I give the collection type a name, then I write a namespace for it, exposing only the actions I want. The <code class="language-plaintext highlighter-rouge">objectByNumber</code> function provides a way to get a cursor to a <code class="language-plaintext highlighter-rouge">Book</code> out of a collection of <code class="language-plaintext highlighter-rouge">Books</code>, i.e. it returns a traversal function suitable for passing to the new <code class="language-plaintext highlighter-rouge">.$()</code> piping operator.</p> <p>There are now quite a few examples of this in <a href="https://github.com/danielearwicker/immuto-react" rel="external nofollow noopener" target="_blank">immuto-react</a> and <a href="https://github.com/danielearwicker/immuto-example" rel="external nofollow noopener" target="_blank">immuto-example</a>.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Not yet regretting the time you've spent here?</h2> <p class="mb-2">Keep reading:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai2/">Poorly Structured Notes on AI Part 2</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai1/">Poorly Structured Notes on AI Part 1</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/Prompt-Engineer/">How to become a prompt engineer</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/Time-reversible-events/">Time reversible events</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/Java-Csharp/">Language Smackdown: Java vs. C#</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Daniel Earwicker. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>