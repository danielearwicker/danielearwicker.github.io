<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Time reversible events | Daniel Earwicker </title> <meta name="author" content="Daniel Earwicker"> <meta name="description" content="You are almost certainly lost on the Internet. "> <meta name="keywords" content="coding, physics"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?754e6b58bcf99910aed4f8d8638bd47f"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://danielearwicker.github.io/blog/2023/Time-reversible-events/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Daniel</span> Earwicker </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Time reversible events</h1> <p class="post-meta"> Created on April 07, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/events"> <i class="fa-solid fa-hashtag fa-sm"></i> events</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>The current state of a system might be represented by the contents of a database table. The table could have many columns of various data types, but to simplify we’ll say there is only a single integer column, so our table is just a list of integers. (Each integer could in reality be a foreign key into another table holding immutable and distinct tuples, each describing a frozen configuration of a more interesting entity such as a person, a medical record and so on. So we can make this simplification without loss of generality.)</p> <p>We can describe the history of the table’s state by creating another table in which the rows represent <em>events</em>. Of course in a database we need to think about atomic transactions; some kinds of change may not make sense by themselves and must always occur atomically as part of a transaction along with certain related changes. Therefore an event always belongs to a <em>batch</em>, and a batch may contain multiple events. Batches occur in a definite order, so we can number them (that is, the primary key of a batch is a sequence number). A batch is also the ideal place to record the clock time that the events in the batch were applied.</p> <p>Aside from the <code class="language-plaintext highlighter-rouge">batch_id</code> an event has just two columns:</p> <ul> <li>the <code class="language-plaintext highlighter-rouge">value</code> that would appear in the current state table</li> <li>a bit <code class="language-plaintext highlighter-rouge">added</code> that is 1 (true) if the value was added or 0 (false) if it was removed (the only other possible event in such a simple system)</li> </ul> <p>Given this table, we can begin with an empty state table, and “play back” the changes, inserting the <code class="language-plaintext highlighter-rouge">value</code> if <code class="language-plaintext highlighter-rouge">added</code> is 1 and removing it if <code class="language-plaintext highlighter-rouge">added</code> is 0, and we will reconstruct the latest state.</p> <p>When deleting, we remove one instance of the specified <code class="language-plaintext highlighter-rouge">value</code>; any two instances of the same <code class="language-plaintext highlighter-rouge">value</code> are equivalent so it doesn’t matter which we delete. All that matters is how many instances there are. Generally is possible that the events in a batch might arrive at a net effect by some redundant route:</p> <table> <thead> <tr> <th style="text-align: center"><code class="language-plaintext highlighter-rouge">value</code></th> <th style="text-align: center"><code class="language-plaintext highlighter-rouge">added</code></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">3</td> <td style="text-align: center">1</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">0</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">0</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">1</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">1</td> </tr> </tbody> </table> <p>This has the net effect of adding 3, as there is one more added than removed. The only danger with such a situation is that order in which the events are replayed is important, as if all the removes were performed first, this could imply that <code class="language-plaintext highlighter-rouge">3</code> occurs a negative number of times in the state table! But such a batch could be simplified at the point of its creation to remove both the unnecessary events and also this problem.</p> <p>To be certain that our events describe the complete history, it would be safest to never directly update the state table, but instead write a batch of events and then execute that batch as described above. The event table is the definitive record of what has occurred. The latest state, arrived at by executing the events, is merely a convenient representation <em>derived</em> from the events.</p> <p>And if we are mostly interested in recent past states, we would prefer to start with the latest state and “rewind” back to a recent past state, if only because this is a shorter journey than starting from the ever-more-distant empty initial state and playing forward. Fortunately our events have an interesting property: we can flip the <code class="language-plaintext highlighter-rouge">added</code> bit, setting it to <code class="language-plaintext highlighter-rouge">1 - added</code>. This makes each “add” into a “remove” and vice versa.</p> <p>This backward time travel can be implemented easily by making our algorithm for playing back events accept an <code class="language-plaintext highlighter-rouge">undo</code> bit parameter. An event causes an insertion if <code class="language-plaintext highlighter-rouge">added != undo</code>, and it causes a removal if <code class="language-plaintext highlighter-rouge">added == undo</code>. Think it through:</p> <ul> <li>playing forwards: <code class="language-plaintext highlighter-rouge">undo</code> is 0, and so <code class="language-plaintext highlighter-rouge">added != 0</code> implies adding, while <code class="language-plaintext highlighter-rouge">added == 0</code> implies removal, as we originally said.</li> <li>playing backwards: <code class="language-plaintext highlighter-rouge">undo</code> is 1, and so <code class="language-plaintext highlighter-rouge">added != 1</code> implies adding, while <code class="language-plaintext highlighter-rouge">added == 1</code> implies removal, so <code class="language-plaintext highlighter-rouge">added</code> has the opposite meaning.</li> </ul> <p>There’s an amusing similarity here with quantum field theory, in which a positron can be thought of as an electron moving backward through time.</p> <p>What makes an event stream time-reversible? There must be no loss of information. In databases we often avoid immutable approaches, and instead overwrite values in existing records. To support this we nominate one column to be immutable so it can act as the primary key. An event that says:</p> <blockquote> <p>In row 15, change <code class="language-plaintext highlighter-rouge">last_name</code> to <code class="language-plaintext highlighter-rouge">"Smith"</code></p> </blockquote> <p>is <em>destructive</em>, as the previous value is lost. The destruction of information rules out reversibility. But capturing it as:</p> <blockquote> <p>In row 15, change <code class="language-plaintext highlighter-rouge">last_name</code> from <code class="language-plaintext highlighter-rouge">"Jones"</code> to <code class="language-plaintext highlighter-rouge">"Smith"</code></p> </blockquote> <p>is enough to restore reversibility. To convert to an undo operation, we simply swap the values in the <em>from</em> and <em>to</em> slots. No doubt we will also support a delete event, in which case the event will have to capture its entire contents:</p> <blockquote> <p>Delete row 15, in which <code class="language-plaintext highlighter-rouge">last_name</code> is <code class="language-plaintext highlighter-rouge">"Smith"</code>, <code class="language-plaintext highlighter-rouge">first_name</code> is…</p> </blockquote> <p>When that event is reversed, it becomes:</p> <blockquote> <p>Insert row 15, in which <code class="language-plaintext highlighter-rouge">last_name</code> is <code class="language-plaintext highlighter-rouge">"Smith"</code>, <code class="language-plaintext highlighter-rouge">first_name</code> is…</p> </blockquote> <p>(Note that the primary key 15 has to be retained, as there must be at least one other event in the past referring to row 15, so we can’t use the popular RDBMS feature that creates a new key from a counter on each insert.)</p> <p>The rules for how to time-reverse an event may appear haphazard, but really they are perfectly consistent. The “change” event is really two events, one that removes a value and the other that adds, so in every case we are in fact turning add into remove and vice versa.</p> <p>Even so, in the simpler scheme where our current state is just integers (which are foreign keys into another table holding immutable records, retaining every distinct combination of values we’ve ever encountered), this quite involved event vocabulary is unnecessary.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Not yet regretting the time you've spent here?</h2> <p class="mb-2">Keep reading:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai3/">Poorly Structured Notes on AI Part 3</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai2/">Poorly Structured Notes on AI Part 2</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai1/">Poorly Structured Notes on AI Part 1</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/Prompt-Engineer/">How to become a prompt engineer</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/Java-Csharp/">Language Smackdown: Java vs. C#</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Daniel Earwicker. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>